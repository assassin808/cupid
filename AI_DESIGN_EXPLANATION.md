# Cupid AI 设计原理解析

## 🎯 核心设计理念

Cupid采用**三agent架构**模拟真实恋爱关系的发展过程。这是一个基于**PersonaLLM**的多智能体系统，模拟两个具有独立人格的AI如何在不同情境下做出选择。

---

## 💕 兼容性分数（Compatibility Score）计算

### 评分机制：**0-50分制**

兼容性分数由**Dating Host（约会主持人）**这个AI agent动态计算，它扮演"命运"或"生活模拟器"的角色。

### 评分逻辑

```
初始分数：25分（中性状态）

每一轮互动后：
  ├── Dating Host 分析双方的选择
  ├── 评估选择是否协调、互补、有助于关系发展
  ├── 根据互动质量增加或减少分数
  └── 范围：0-50分
      ├── 0-15分：关系不和谐，可能提前结束
      ├── 16-30分：关系一般，需要改进
      ├── 31-40分：关系良好，有发展潜力
      └── 41-50分：高度契合，理想伴侣
```

### 评分示例

**场景**: "你们在咖啡店相遇，对方向你微笑"

**Avatar 1 (Male)**: 选择 A "主动打招呼并介绍自己"  
理由："我喜欢认识新朋友"

**Avatar 2 (Female)**: 选择 A "热情回应并分享咖啡推荐"  
理由："我享受社交互动"

**Dating Host 评估**:  
✅ 双方都选择积极互动  
✅ 展现了开放性和社交意愿  
✅ 回应方式互补（主动+热情）  
**分数变化**: 25 → 32 (+7分)

---

**场景**: "计划周末活动时意见不同"

**Avatar 1**: 选择 B "坚持自己的想法"  
理由："我认为我的计划更合理"

**Avatar 2**: 选择 B "也坚持自己的想法"  
理由："我不想妥协"

**Dating Host 评估**:  
❌ 双方都不愿妥协  
❌ 缺乏沟通和灵活性  
❌ 可能导致冲突  
**分数变化**: 32 → 26 (-6分)

---

## 🎲 为什么使用选择题？

### 1. **模拟真实决策场景**

现实生活中，我们在关系中面临的大多数情况都有**有限的选择**：
- 是否主动联系对方？
- 约会迟到了如何回应？
- 意见不合时选择争论还是妥协？

选择题比开放式问题更能模拟**真实的决策压力**。

### 2. **PersonaLLM 设计原则**

这个设计符合PersonaLLM论文的核心思想：
```
真实的人格 = 在一致性情境下的选择模式
```

通过让AI在**多个场景**中做选择，我们可以观察：
- ✅ 人格一致性（是否总是主动/被动？）
- ✅ 价值观（重视独立还是亲密？）
- ✅ 应对冲突的方式（回避、对抗、协商？）
- ✅ 关系发展的节奏（快速亲密 vs 慢慢了解？）

### 3. **可控性与可解释性**

**选择题的优势**：
```python
# 开放式问题（不可控）
"你会对这个人说什么？"
→ AI可能说任何话，难以量化和比较

# 选择题（可控）
"你会如何回应？"
A. 主动邀请见面
B. 礼貌回应后观察
C. 保持距离
→ 每个选项有明确含义，可以追踪模式
```

### 4. **Dating Host 的角色**

Dating Host 不仅是"出题者"，更是：
- 📖 **叙事者**: 根据前面的互动设计下一个合理的场景
- ⚖️ **裁判**: 判断双方选择的契合度
- 🎬 **导演**: 推动故事发展（初识→约会→深入→结局）
- 📊 **分析师**: 实时计算兼容性分数

---

## 🏗️ 三Agent架构

```
┌─────────────────────────────────────────────────┐
│           Dating Host (约会主持人)                │
│  • 生成场景和选择题                                │
│  • 接收双方决策                                    │
│  • 计算兼容性分数 (0-50)                          │
│  • 决定是否继续或结束                              │
└──────────────┬──────────────────┬────────────────┘
               │                  │
       生成场景 │                  │ 评估互动
               ▼                  ▼
    ┌──────────────┐      ┌──────────────┐
    │  Male Agent  │◄────►│ Female Agent │
    │  男性人格AI   │ 互动  │  女性人格AI   │
    └──────────────┘      └──────────────┘
         │                      │
         └──────────┬───────────┘
                    │
            根据个人信息做决策：
            • Nickname
            • Age, Gender
            • Occupation
            • Interests
            • Bio (个人简介)
```

---

## 🔄 完整互动流程

```
1. 初始化 (cumulative_rate = 25)
   Dating Host: "/Start" → 生成第一个场景

2. 场景生成
   Dating Host: "你们在公园跑步时对视了，你会怎么做？"
   选项: A. 微笑打招呼  B. 专注跑步  C. 等待对方主动

3. 决策阶段 (Female先/Male先 由Host决定)
   Female Agent: 
   {
     "decision": {"option": "A", "content": "微笑并打招呼"},
     "rationale": "我喜欢认识新朋友，这是个好机会"
   }

4. Dating Host 处理并生成下一个场景
   → 分析Female的选择
   → 生成Male的相关场景
   → 更新cumulative_rate

5. Male 决策
   Male Agent:
   {
     "decision": {"option": "A", "content": "回应微笑并邀请一起跑"},
     "rationale": "她很友好，我想继续交流"
   }

6. Dating Host 评估互动
   → 双方都选择积极互动 ✅
   → cumulative_rate: 25 → 32 (+7)
   → 生成下一个场景："你们约好第二天一起跑步..."

7. 重复 2-6 步骤（最多10轮）

8. 结束条件
   - Dating Host判断关系应该结束
   - 达到10轮上限
   - 分数过低（关系破裂）
   - 分数很高（关系确立）
```

---

## 📊 输出数据结构

### Dating Host 输出
```json
{
  "action": {
    "type": "predict",
    "object": "Female",
    "question": "场景描述",
    "answers": "A. 选项1 B. 选项2 C. 选项3"
  },
  "time": "Day 1, Morning",
  "cumulative_rate": "32",
  "rationale": "Host的思考过程"
}
```

### Agent 输出
```json
{
  "gender": "Female",
  "decision": {
    "option": "A",
    "content": "具体行动描述"
  },
  "rationale": "我为什么这样选择"
}
```

---

## 🎯 "Love First, Know Later" 研究概念

这个设计完美支持研究主题：

1. **先建立情感** (Love First)
   - 通过10轮场景模拟完整的关系发展
   - AI根据人格做出一致的选择
   - 累积的分数代表"情感连接"

2. **后分析原因** (Know Later)
   - 每个决策都有rationale（理由）
   - 可以回溯查看为什么两人契合/不契合
   - 研究者能看到完整的决策链

### 研究价值

```
传统约会：先了解信息 → 判断是否合适 → 尝试交往
AI模拟：模拟真实互动 → 观察实际契合度 → 分析背后原因

优势：
✅ 绕过"刻板印象"（学历、外貌、收入）
✅ 关注"行为契合度"（如何应对冲突、是否有共同节奏）
✅ 可重复、可量化、可分析
```

---

## 🔧 技术实现要点

### 1. Prompt Engineering
```python
# Male Agent的指令
f"""
You are {nickname}, you will meet a girl...
Make decisions that reflect your personality.

# Output Format (严格JSON):
{{
  "decision": {{"option": "A", "content": "action"}},
  "rationale": "why you chose this"
}}
"""
```

### 2. Dating Host的智能性
```python
# Host需要：
- 记住之前的所有互动历史
- 根据双方选择设计合理的下一个场景
- 维护timeline的连贯性（Day 1 Morning → Day 1 Afternoon → Day 2...）
- 动态调整难度（初期简单场景，后期复杂冲突）
- 判断何时应该结束（positive ending vs negative ending）
```

### 3. 前端可视化
现在的sandbox显示：
- 🎬 灰色场景块：Host生成的问题
- 👨 蓝色决策卡：Male的选择+理由
- 👩 粉色决策卡：Female的选择+理由  
- 💕 分数更新：实时显示兼容性变化

---

## ✨ 总结

| 要素 | 设计原因 |
|------|---------|
| **0-50分制** | 中性起点(25)，可升可降，模拟关系的动态性 |
| **选择题** | 控制变量、量化决策、符合PersonaLLM理论 |
| **Dating Host** | 独立的"上帝视角"，确保场景合理和评分客观 |
| **10轮上限** | 防止无限循环，模拟"蜜月期"决策窗口 |
| **实时streaming** | 研究透明度，让用户看到AI"思考"过程 |

这不是简单的匹配算法，而是一个**模拟真实关系发展的AI生活实验室**。
