<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="static/user_settings.css">
</head>
<body>
    <!-- Mobile Top Banner -->
    <div class="mobile-banner d-flex align-items-center px-3 py-2 d-md-none">
        <span class="brand-title flex-grow-1" style="font-size:1.2rem;letter-spacing:1px;">cupid.ai</span>
        <button class="menu-toggle-btn btn p-0" onclick="toggleSidebarMenu()">
            <i class="fas fa-bars fa-lg"></i>
        </button>
    </div>
    <div class="settings-layout d-flex">
        <!-- Sidebar (desktop & mobile drawer) -->
        <aside class="sidebar d-flex flex-column align-items-center py-4" id="sidebarMenu">
            <div class="sidebar-logo mb-4 d-none d-md-block">
                <span class="brand-title" style="font-size:1.5rem;letter-spacing:1px;">cupid.ai</span>
            </div>
            <nav class="sidebar-menu flex-grow-1 w-100">
                <ul class="nav flex-column w-100">
                    <li class="nav-item mb-3"><a class="nav-link active" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                    <li class="nav-item mb-3"><a class="nav-link" href="#"><i class="fas fa-lock me-2"></i>Account</a></li>
                    <li class="nav-item mb-3"><a class="nav-link" href="#"><i class="fas fa-bell me-2"></i>Notifications</a></li>
                    <li class="nav-item mb-3"><a class="nav-link" href="#"><i class="fas fa-shield-alt me-2"></i>Security</a></li>
                </ul>
            </nav>
            <div class="sidebar-avatar mt-auto pt-4">
                <img src="" id = "avatar" alt="Avatar" class="rounded-circle" style="width:56px;height:56px;object-fit:cover;border:2px solid #eee;">
                <a class="nav-link text-danger mt-3 d-block text-center" href="#" id = "logoutBtn" style="font-weight:500;"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
            </div>
        </aside>
        <!-- Main Content -->
        <main class="settings-main flex-grow-1 px-4 py-5">
            <div class="settings-box shadow-lg p-4 bg-white rounded-4">
                <button class="btn btn-outline-secondary back-btn mb-3" onclick="window.location.href='/'">
                    <i class="fas fa-arrow-left me-2"></i>Back to Home
                </button>
                <div class="text-center mb-4">
                    <h2 class="brand-title mb-2">User Settings</h2>
                    <div class="text-muted">View and edit your information</div>
                </div>
                <form id="settingsForm">
                    <div class="mb-4 text-center">
                        <div class="avatar-container position-relative d-inline-block" onclick="document.getElementById('avatar').click();">
                            <img id="avatarPreview" src="" alt="Avatar" class="rounded-circle">
                            <div class="avatar-overlay">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <input type="file" id="avatar" accept="image/*" style="display:none;">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="nickname" class="form-label">
                            <i class="fas fa-user me-2"></i>Nickname
                        </label>
                        <input type="text" class="form-control" id="nickname" placeholder="Enter your nickname">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-venus-mars me-2"></i>Gender
                        </label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male">
                                <label class="form-check-label" for="genderMale">Male</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female">
                                <label class="form-check-label" for="genderFemale">Female</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="gender" id="genderOther" value="other">
                                <label class="form-check-label" for="genderOther">Other</label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="hobbies" class="form-label">
                            <i class="fas fa-heart me-2"></i>Hobbies
                        </label>
                        <input type="text" class="form-control" id="hobbies" placeholder="e.g. Reading, Music, Sports">
                    </div>
                    <div class="mb-4">
                        <label for="birthday" class="form-label">
                            <i class="fas fa-birthday-cake me-2"></i>Birthday
                        </label>
                        <input type="date" class="form-control" id="birthday">
                    </div>
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
                </form>
            </div>
        </main>
    </div>
    <script>
    // 移动端菜单切换
    function toggleSidebarMenu() {
        var sidebar = document.getElementById('sidebarMenu');
        sidebar.classList.toggle('show-mobile');
    }
    // 返回首页
    function goBack() {
        window.location.href = '/';
    }

    // 头像预览和上传
    document.getElementById('avatar').onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                const avatarPreview = document.getElementById('avatarPreview');
                avatarPreview.style.opacity = '0';
                setTimeout(() => {
                    avatarPreview.src = evt.target.result;
                    avatarPreview.style.opacity = '1';
                }, 200);
            };
            reader.readAsDataURL(file);
        }
    };

    // 表单提交处理
    document.getElementById('settingsForm').onsubmit = function(e) {
        e.preventDefault();
        // 这里添加表单提交逻辑
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        submitBtn.disabled = true;
        
        // 模拟保存过程
        setTimeout(() => {
            submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Saved!';
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Changes';
                submitBtn.disabled = false;
            }, 2000);
        }, 1500);
    };

    // 进入具体聊天时
    //document.querySelector('.back-home-fixed').style.display = 'none';

    // 返回聊天列表时
    //document.querySelector('.back-home-fixed').style.display = '';

    document.addEventListener('DOMContentLoaded', function() {
        fetch('/get_user_info', {
            method: 'GET',
            credentials: 'include'
        })
        .then(async res => {
            if (res.status === 401) {
                window.location.href = '/login_register';
                return;
            }
            const data = await res.json();
            if (data.status && data.status === 'not_logged_in') {
                window.location.href = '/login_register';
                return;
            }
            console.log(data)
            // 自动填充表单
            if (data.information) {
                document.getElementById('nickname').value = data.information.nickname || '';
                document.getElementById('birthday').value = data.information.birthday || '';
                document.getElementById('hobbies').value = data.information.hobbies || '';
                document.getElementById('avatar').src = data.information.avatar;
                // 性别单选框
                if (data.information.gender) {
                    const gender = data.information.gender;
                    if (gender === 'male') document.getElementById('genderMale').checked = true;
                    else if (gender === 'female') document.getElementById('genderFemale').checked = true;
                    else if (gender === 'other') document.getElementById('genderOther').checked = true;
                }
                // 头像
                if (data.information.avatar) {
                    document.getElementById('avatarPreview').src = data.information.avatar;
                }
            }
        })
        .catch(() => {
            window.location.href = '/login_register';
        });
    });

    // 登出按钮事件
    document.getElementById('logoutBtn').onclick = function(e) {
        e.preventDefault();
        window.location.href = '/logout';
    };
    </script>
</body>
</html> 